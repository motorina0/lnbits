{% block page %}
<div>
    <iframe
    ref="extensionIframe"
    onload="handleExtensionIframeLoad(this)"
    title="LNbits Extension"
    width="100%"
    height="100%"
    style="border: none"
    src="dist/index.html"
  >
  </iframe>
  
</div>

{% endblock %} {% block scripts %}

<script>

function handleExtensionIframeLoad(iframe) {
    resizeIframe(iframe)
    resizeIframeOnChange(iframe)
    shareState(iframe)
  }

  function resizeIframe(iframe) {
    iframe.style.height =
      iframe.contentWindow.document.documentElement.scrollHeight + 'px'
  }

  function shareState(iframe) {
    const params = Object.fromEntries(new URLSearchParams(location.search));
    iframe.contentWindow.postMessage(
      {
        type: 'init',
        extensionId: '{{ext_id}}',
        publicData: JSON.parse(decodeURIComponent(escape(window.atob('{{public_data_base64}}')))),
      },
      '*'
    ) // todo: domain
  }

  function resizeIframeOnChange(iframe) {
    const observer = new MutationObserver(() => {
      resizeIframe(iframe)
    })
    observer.observe(iframe.contentWindow.document, {
      attributes: true,
      childList: true,
      subtree: true
    })
  }

</script>
{% endblock %}
