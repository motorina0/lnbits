{% extends "base.html" %} {% from "macros.jinja" import window_vars with context
%} {% block page %}
<div class="row q-col-gutter-md">
  <div class="col-12 col-md-7 q-gutter-y-md">
    <iframe
      ref="extensionIframe"
      onload="handleExtensionIframeLoad(this)"
      title="LNbits Extension"
      width="100%"
      height="100%"
      style="border: none"
      :src="iframeSrc"
    >
    </iframe>
  </div>
</div>
{% endblock %} {% block scripts %} {{ window_vars(user) }}
<script>
  function handleExtensionIframeLoad(iframe) {
    resizeIframe(iframe)
    shareState(iframe)
  }

  function resizeIframe(iframe) {
    iframe.style.height =
      iframe.contentWindow.document.documentElement.scrollHeight + 'px'
  }

  function shareState(iframe) {
    iframe.contentWindow.postMessage({a: "hello from parent!"}, "*");
    console.log('### shareState 1')
  }

  new Vue({
    el: '#vue',
    mixins: [windowMixin],
    data: function () {
      return {
        iframeSrc: '',
        extensionId: '{{ext_id}}'
      }
    },
    methods: {},
    created: function () {
      this.iframeSrc = `${this.extensionId}/dist/index.html`
      // const iframe = this.$refs.extensionIframe
      // console.log('### iframe', iframe)
    }
  })
</script>
{% endblock %}
